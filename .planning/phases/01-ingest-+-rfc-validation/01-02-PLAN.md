---
phase: 01-ingest-+-rfc-validation
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - package.json
  - package-lock.json
  - src/types/analysis.ts
  - src/analysis/playlist/text.ts
  - src/analysis/playlist/parseM3U8.ts
autonomous: true
must_haves:
  truths:
    - "Valid M3U8 input parses without a parser error and yields a manifest object."
    - "Normalized playlist text preserves original line ordering for downstream line references."
    - "Parsing outputs include the manifest plus normalized lines for validation and classification steps."
  artifacts:
    - path: "src/analysis/playlist/parseM3U8.ts"
      provides: "M3U8 parsing wrapper"
    - path: "src/analysis/playlist/text.ts"
      provides: "Playlist text normalization with line preservation"
    - path: "src/types/analysis.ts"
      provides: "Analysis domain types"
  key_links:
    - from: "src/analysis/playlist/parseM3U8.ts"
      to: "src/analysis/playlist/text.ts"
      via: "normalize playlist text"
      pattern: "normalize"
    - from: "src/analysis/playlist/parseM3U8.ts"
      to: "m3u8-parser"
      via: "Parser import"
      pattern: "m3u8-parser"
---

<objective>
Implement the Phase 1 parsing foundations and shared analysis types.

Purpose: Ensure valid playlists can be parsed and normalized for downstream validation and UI outputs.
Output: Typed analysis domain models and a parsing wrapper that preserves line mapping.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-ingest-+-rfc-validation/01-CONTEXT.md
@.planning/phases/01-ingest-+-rfc-validation/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add analysis types and parser dependency</name>
  <files>package.json, package-lock.json, src/types/analysis.ts</files>
  <action>
    Install `m3u8-parser` and add analysis domain types for:
    - ValidationIssue (severity, message, hint, tag?, line?)
    - PlaylistClassification (playlistType, streamType)
    - LadderVariant (bitrate, averageBandwidth?, resolution?, codecs, frameRate?)
    - AnalysisResult (validation, classification, ladder, reliable flag)
  </action>
  <verify>npm run build</verify>
  <done>Analysis types compile and `m3u8-parser` is available for parsing.</done>
</task>

<task type="auto">
  <name>Task 2: Implement playlist text normalization and parse wrapper</name>
  <files>src/analysis/playlist/text.ts, src/analysis/playlist/parseM3U8.ts</files>
  <action>
    Create a small text helper to normalize playlist text (strip UTF-8 BOM, preserve line numbers) and
    a parseM3U8 wrapper that returns the manifest plus normalized raw lines for validation.
  </action>
  <verify>npm run build</verify>
  <done>Parsing wrapper returns manifest + normalized lines and compiles without TS errors.</done>
</task>

</tasks>

<verification>
`npm run build` completes without errors.
</verification>

<success_criteria>
Parsing foundations compile and can be consumed by validation/classification steps.
</success_criteria>

<output>
After completion, create `.planning/phases/01-ingest-+-rfc-validation/01-02-SUMMARY.md`
</output>
