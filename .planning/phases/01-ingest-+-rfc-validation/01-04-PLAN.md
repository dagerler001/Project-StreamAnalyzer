---
phase: 01-ingest-+-rfc-validation
plan: 04
type: execute
wave: 4
depends_on: ["01-03"]
files_modified:
  - public/fixtures/live/master.m3u8
  - public/fixtures/live/360p.m3u8
  - public/fixtures/live/720p.m3u8
  - public/fixtures/vod/master.m3u8
  - public/fixtures/vod/360p.m3u8
  - src/analysis/resolver/mockCdnMap.ts
  - src/hooks/usePlaylistAnalysis.ts
autonomous: true
gap_closure: true
must_haves:
  truths:
    - "In Channel/VOD ID mode, known IDs resolve to reachable playlists and analysis completes without fetch errors."
    - "ID mode renders Validation, Classification, and ABR Ladder sections for both channel and VOD examples."
  artifacts:
    - path: "public/fixtures/live/master.m3u8"
      provides: "Reachable live master playlist fixture"
    - path: "public/fixtures/vod/master.m3u8"
      provides: "Reachable VOD master playlist fixture"
    - path: "src/analysis/resolver/mockCdnMap.ts"
      provides: "ID-to-fixture URL mapping"
  key_links:
    - from: "src/analysis/resolver/resolveInput.ts"
      to: "src/analysis/resolver/mockCdnMap.ts"
      via: "MOCK_CDN_MAP lookup"
      pattern: "MOCK_CDN_MAP\["
    - from: "src/hooks/usePlaylistAnalysis.ts"
      to: "public/fixtures"
      via: "fetch(resolved ID URL)"
      pattern: "fetch\(.*resolveResult\.url"
---

<objective>
Restore ID-mode analysis by mapping known IDs to reachable local fixture playlists.

Purpose: Eliminate "Failed to fetch" errors in UAT by replacing placeholder URLs with real, local fixtures.
Output: Fixture playlists under public/fixtures and updated ID resolver wiring.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/phases/01-ingest-+-rfc-validation/01-UAT.md
@.planning/phases/01-ingest-+-rfc-validation/01-02-SUMMARY.md
@.planning/phases/01-ingest-+-rfc-validation/01-03-SUMMARY.md
@src/analysis/resolver/mockCdnMap.ts
@src/hooks/usePlaylistAnalysis.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add local fixture playlists for ID resolution</name>
  <files>
public/fixtures/live/master.m3u8
public/fixtures/live/360p.m3u8
public/fixtures/live/720p.m3u8
public/fixtures/vod/master.m3u8
public/fixtures/vod/360p.m3u8
  </files>
  <action>
Create a minimal, valid set of fixture playlists under public/fixtures that are reachable via fetch:
- Live master playlist with at least two EXT-X-STREAM-INF entries (360p + 720p), each pointing to local media playlists.
- Live media playlists with EXTINF segments and no ENDLIST tag.
- VOD master playlist with EXT-X-PLAYLIST-TYPE:VOD and at least one EXT-X-STREAM-INF entry pointing to a local VOD media playlist.
- VOD media playlist with EXTINF segments and ENDLIST tag.
- Include EXTM3U and EXT-X-VERSION tags so validation/classification behave consistently.
- Keep all URIs relative to /fixtures to avoid external network dependency.
  </action>
  <verify>npm run build</verify>
  <done>Fixture playlists are present under public/fixtures and can be fetched by relative URL without network failures.</done>
</task>

<task type="auto">
  <name>Task 2: Point ID resolver to local fixtures and normalize fetch URLs</name>
  <files>
src/analysis/resolver/mockCdnMap.ts
src/hooks/usePlaylistAnalysis.ts
  </files>
  <action>
Update ID mode to use the new local fixtures and avoid placeholder URLs:
- Replace mockCdnMap URLs with /fixtures/live/master.m3u8 and /fixtures/vod/master.m3u8 for the documented IDs (ch-live-1, vod-movie-123, etc.).
- In usePlaylistAnalysis, when inputType is "id", normalize resolveResult.url so relative paths resolve against window.location.origin before fetch.
- Keep error handling consistent (unknown IDs still surface resolveResult.message).
  </action>
  <verify>npm run build</verify>
  <done>Known IDs resolve to local fixtures and the ID flow fetches without "Failed to fetch" errors.</done>
</task>

</tasks>

<verification>
Run the app and verify ID mode:
1. Select Channel/VOD ID mode, enter ch-live-1, click Analyze.
2. Expect loading state then Validation, Classification, and ABR Ladder sections render (no "Failed to fetch").
3. Repeat with vod-movie-123 and verify the same sections render and stream type indicates VOD.
</verification>

<success_criteria>
- ID mode works for known IDs without network errors.
- Results sections render for both live and VOD IDs using local fixture playlists.
</success_criteria>

<output>
After completion, create `.planning/phases/01-ingest-+-rfc-validation/01-04-SUMMARY.md`
</output>
